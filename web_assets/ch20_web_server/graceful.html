<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Graceful Shutdown - Rust Web Server</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f0f0f0; }
        .container { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #d73502; }
        .nav { margin: 20px 0; }
        .nav a { margin-right: 15px; color: #d73502; text-decoration: none; padding: 5px 10px; border-radius: 3px; }
        .nav a:hover { background: #d73502; color: white; }
        .feature { background: #e8f5e8; padding: 15px; border-left: 4px solid #4CAF50; margin: 20px 0; }
        .warning { background: #fff3cd; padding: 15px; border-left: 4px solid #ffc107; margin: 20px 0; }
        code { background: #f5f5f5; padding: 2px 6px; border-radius: 3px; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü¶Äüõ°Ô∏è Graceful Shutdown Web Server</h1>
        <p>Welcome to our Rust web server with graceful shutdown capabilities!</p>
        
        <div class="nav">
            <a href="/">Home</a>
            <a href="/about">About</a>
            <a href="/shutdown">Shutdown Info</a>
            <a href="/sleep">Sleep Test</a>
        </div>
        
        <div class="feature">
            <strong>‚ú® New Feature:</strong> This server implements graceful shutdown using Rust's Drop trait!
        </div>
        
        <div class="warning">
            <strong>‚ö†Ô∏è Demo Behavior:</strong> This server will automatically shut down after handling 5 requests
            to demonstrate the graceful shutdown process.
        </div>
        
        <h2>Graceful Shutdown Features</h2>
        <ul>
            <li>‚úÖ <code>Drop</code> trait implementation for cleanup</li>
            <li>‚úÖ Message-based worker termination</li>
            <li>‚úÖ Proper thread joining</li>
            <li>‚úÖ Resource deallocation</li>
            <li>‚úÖ No abrupt termination</li>
        </ul>
        
        <h2>Shutdown Process</h2>
        <ol>
            <li><strong>Stop accepting new requests</strong> - Main loop exits</li>
            <li><strong>Signal workers</strong> - Send <code>Message::Terminate</code> to all workers</li>
            <li><strong>Wait for completion</strong> - Join all worker threads</li>
            <li><strong>Clean up resources</strong> - Drop trait handles cleanup</li>
        </ol>
        
        <h2>Technical Implementation</h2>
        <ul>
            <li><strong>Message Enum:</strong> <code>NewJob(Job)</code> and <code>Terminate</code></li>
            <li><strong>Optional JoinHandle:</strong> <code>Option&lt;thread::JoinHandle&lt;()&gt;&gt;</code></li>
            <li><strong>RAII Pattern:</strong> Resource cleanup in Drop trait</li>
            <li><strong>Channel Communication:</strong> Coordinated shutdown</li>
        </ul>
        
        <p>Check your terminal to see the detailed shutdown process when the server stops!</p>
        
        <p><small>Built with ‚ù§Ô∏è in Rust | Chapter 20.3 | Graceful Shutdown Edition</small></p>
    </div>
</body>
</html>